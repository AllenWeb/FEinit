/*! mix 0.3.0 2013-04-26 by Theowang */
(function(t,e){"use strict";function n(t,e){return F.toString.call(t).slice(8,-1)===e}function i(n,i,r,s){if(0===arguments.length)throw Error("Module: I need a agrument");N.isFunction(n)?(r=n,n=e,i=O):N.isArray(n)?(i=O,n=e):N.isFunction(i)&&(r=i,i=O),this.id=n?a(n)[2]:n,this.status="uninitialized",N.isString(i)&&(i=i.split(",")),this.dependencies=i,this.factory=r,this.root=s||t,this.undef=[],this.id&&(D[this.id]="uninitialized"),this.checkDependencies(i),this.define()}function r(t){return"THEO"===t.amd}function s(t){return"defined"===D[t]}function o(){this.status="unfulfilled",this.fulfilledHandlers=[],this.errorHandlers=[],this.reason=""}function u(t){return t instanceof o}function a(t,e){var n,i,r,s,o=_.alias;if(e=e||H.baseURL,e=e.substr(0,e.lastIndexOf("/")),s=t,R.test(t)&&o[t])n=o[t];else if(/^(\w+)(\d)?:.*/.test(t))n=t;else if(i=t.charAt(0),r=t.slice(0,2),"."!==i&&"/"!==i)n=e+"/"+t;else if("./"===r)s=t.substr(2),n=e+"/"+s;else if(".."===r){var u=e.split("/");i=t.replace(/\.\.\//g,function(){return u.pop(),""}),s=i,n=u.join("/")+"/"+i}var a="js";return i=n.replace(/[?#].*/,""),/\.(\w+)$/.test(i)&&(a=RegExp.$1),"css"===a||i!==n||j.test(n)||(n+=".js"),[n,a,s]}function f(t,e,n,i,r,s){if(N.isObject(t))return e=t.callback,n=t.attrs,i=t.timeout,r=t.fail,s=t.complete,t=t.src,f(t,e,n,i,r,s);var o=g.createElement("script"),u=!1;if(N.isObject(n))for(var l in n)o.setAttribute(l,n[l]);var d=a(t);return t=o.src=d[0],o.async=!0,o.type="text/javascript",o.charset=H.charset,s=N.isFunction(s)?s:b,o.onload=o.onreadystatechange=function(n){n=n||F,u||"load"!==n.type&&!/loaded|complete|undefined/.test(o.readyState)||(u=!0,c(o),B[t]="loaded",N.isFunction(e)&&e(),s("load"))},o.onerror=function(){u=!0,B[t]="error",N.isFunction(r)&&r(),s("error")},i=N.isNumber(i)?i:H.timeout,i&&m(function(){u||(u=!0,B[t]="timeout",s("timeout"))},i),B[t]="pending",S.insertBefore(o,E),_}function c(t){t.onload=t.onerror=t.onreadystatechange=null,t.parentNode&&m(function(){t.parentNode.removeChild(t),t=null},0)}function l(t,e,n,i,r,s){if(N.isObject(t))return e=t.callback,n=t.attrs,i=t.timeout,r=t.fail,s=t.complete,t=t.href,l(t,e,n,i,r,s);var o=g.createElement("link"),u=!1;i=N.isNumber(i)?i:H.timeout;var f=a(t);if(t=o.href=f[0],o.rel="stylesheet",o.type="text/css",s=N.isFunction(s)?s:b,N.isObject(n))for(var c in n)o.setAttribute(c,n[c]);var d=function(){u||(u=!0,o.onload=o.onerror=o.onreadystatechange=null,B[t]="loaded",N.isFunction(e)&&e(),s("load"))},h=function(){u=!0,o.onload=o.onerror=o.onreadystatechange=null,B[t]="error",N.isFunction(r)&&r(),s("error")};return C(o,d,h),i&&m(function(){u||(u=!0,B[t]="timeout",s("timeout"))},i),B[t]="pending",S.insertBefore(o,E),_}function d(t,n){var i=!1,r=T[t.href]++;if(r>300)return n(),i=!0,e;if($)t.sheet&&(i=!0);else if(t.sheet)try{t.sheet.cssRules&&(i=!0)}catch(s){"NS_ERROR_DOM_SECURITY_ERR"===s.name&&(i=!0)}m(function(){i?n():d(t,n)},50)}function h(t){for(var e in t)t.hasOwnProperty(e)&&t[e]&&(N.isArray(t[e])&&(t[e].length=0),N.isFunction(t[e].destroy)&&t[e].destroy(),delete t[e])}function p(t,e,n){var i,r=x.call(arguments),s=1;for(n=N.isBoolean(n)?n:!0;e=r[s++];)if(N.isArray(e))for(var o=0,u=e.length;u>o;o++)p(t,e[o],n);else for(i in e)!n&&i in t||(t[i]=e[i]);return t}var g=t.document,m=t.setTimeout,v=function(){var t=g.getElementsByTagName("script");return t[t.length-1]}(),y="MixJS 0.3 butterfly",b=function(){},F={},O=[],S=g.head||g.getElementsByTagName("head")[0]||g.documentElement,E=S.getElementsByTagName("base")[0]||null,x=O.slice,A=function(t){var e=t.hasAttribute?t.src:t.getAttribute("src",4);return e.substr(0,e.lastIndexOf("/"))+"/"}(v),j=/\.js$/i,w=/\.css$/i,R=/^[-\w\d_$]{2,}$/i,N={},H={timeout:2e4,baseURL:A,charset:"utf-8"},k={},B={},D={},J={};"Function,String,Array,Number".replace(/[^, ]+/g,function(t){N["is"+t]=function(e){return n(e,t)}}),N.isFunction=function(t){return"function"==typeof t},N.isObject=function(t){return"object"==typeof t},N.isBoolean=function(t){return t===!0||t===!1||n(t,"Boolean")},N.isUndefined=function(t){return t===e};var M=t.navigator.userAgent;i.prototype={constructor:i,define:function(){this.canDefine()?this.namespace():"pending"!==this.status&&(this.status="pending",this.id&&(D[this.id]=this.status),this.loadDeps())},namespace:function(){for(var t,e,n=N.isString(this.id)?this.id.split("/"):O,i=this.root;t=n.shift();)e=t,n.length&&(i=i[t]);try{var r=N.isFunction(this.factory)&&this.factory.apply(this.root,this.getArgs());r&&(r.amd="THEO",i[e]=r,this.id&&(D[this.id]="defined"))}catch(s){throw this.id&&(D[this.id]="error"),Error("Module.namespace error:id=>"+this.id+";undef=>"+this.undef.join(",")+";info=>"+s.message)}this.id&&N.isArray(J[this.id])&&_.each(J[this.id],function(t){u(t)&&t.resolve()}),this.destroy()},getFn:function(t){t=t.split("/");for(var e,n=this.root;e=t.shift();)n=n[e];return n},getArgs:function(){for(var t,e=this.dependencies,n=[],i=0,r=e.length;r>i;i++)t=e[i],n.push(this.getFn(t));return n},canDefine:function(){for(var t,e=this.undef,n=e.length;n--;)if(t=e[n],!s(t)){if((w.test(t)||j.test(t))&&_.loaded(t))continue;return!1}return!0},loadDeps:function(){var t,e=this,n=e.undef;_.each(n,function(n){if(t=new o,J[n]=J[n]?J[n]:[],J[n].push(t.done(function(){e.define()})),"pending"!==D[n]){var i=_.alias(n);if(i&&i.length){var r=new o;r.done(function(){e.define()});var s=i.length,u=function(){s--,0===s&&(D[n]="defined",r.resolve())};_.each(i,function(t){if(w.test(t))_.loadCSS(t,u);else if(j.test(t))_.loadJS(t,u);else{var e=new o;J[t]=J[t]?J[t]:[],J[t].push(e.done(u)),_.loadJS(t)}})}else w.test(n)?_.loadCSS(n,function(){e.define()}):j.test(n)?_.loadJS(n,function(){e.define()}):_.loadJS(n)}})},checkDependencies:function(t){var e=this;_.each(t,function(t){t=a(t)[2],s(t)||e.undef.push(t)})},destroy:function(){h(this)}},o.prototype={constructor:o,reject:function(t){return"unfulfilled"!==this.status?this:(this.reason=t,this.status="failed",this.fire(this.errorHandlers,t))},isResolved:function(){return"fulfilled"===this.status},resolve:function(t){return"unfulfilled"!==this.status?this:(this.reason=t,this.status="fulfilled",this.fire(this.fulfilledHandlers,t))},fail:function(t){return this.then(e,t)},always:function(t){return this.then(t,t)},then:function(t,e){switch(this.status){case"unfulfilled":this.add(t,"fulfilled").add(e,"error");break;case"fulfilled":this.fire(t,this.reason);break;case"failed":this.fire(e,this.reason)}return this},done:function(t){return this.then(t)},fire:function(t,e){if(N.isArray(t)){for(var n;n=t.shift();)N.isFunction(n)&&n(e);this.clear()}else N.isFunction(t)&&t(e);return this},add:function(t,e){return e+="Handlers",N.isFunction(t)&&this[e]&&this[e].push(t),this},clear:function(){this.fulfilledHandlers.length=0,this.errorHandlers.length=0}};var T={},$=536>Number(M.replace(/.*AppleWebKit\/(\d+)\..*/,"$1")),U=~M.indexOf("Firefox")&&!("onload"in g.createElement("link")),C=$||U?function(t,e){N.isFunction(e)&&(T[t.href]=0,m(function(){d(t,e)},50))}:function(t,e,n){N.isFunction(e)&&(t.onload=function(){e()}),N.isFunction(n)&&(t.onerror=function(){n()})},_={version:y,mix:p,indexOf:function(t,e,n){if(null==t)return-1;var i=0,r=t.length;if(n&&(i=0>n?Math.max(0,r+n):n),O.indexOf&&t.indexOf===O.indexOf)return t.indexOf(e,n);for(;r>i;i++)if(t[i]===e)return i;return-1},each:O.forEach?function(t,e,n){O.forEach.call(t,e,n)}:function(t,e,n){for(var i=0,r=t.length;r>i;i++)i in t&&e.call(n,t[i],i,t)},defined:s,define:function(t,e,n){return new i(t,e,n),this},use:function(t,n){return new i(e,t,n),this},config:function(t){return N.isObject(t)?(p(H,t),this):H},loaded:function(t){return t=a(t)[0],"loaded"===_.status(t)},status:function(t){return B[t]},alias:function(t,e){if(R.test(t)){if(N.isUndefined(e))return k[t];k[t]=(e+"").split(",")}else N.isObject(t)&&(e=t.path,t=t,_.alias(t,e))},loadJS:f,loadCSS:l,Promise:o,isAMD:r};N.isUndefined(t.define)&&(t.define=_.define),t.MixJS=p(_,N)})(this);
//@ sourceMappingURL=lib/mix.0.3.0.map